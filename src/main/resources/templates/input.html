<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Predix - ìì˜ì—…ì ë§¤ì¶œ ì˜ˆì¸¡ ì‹œìŠ¤í…œ</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background-color: #f4f6f8;
      }

      /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
      .navbar {
        background-color: #1e3a8a;
        color: white;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .navbar h1 {
        font-size: 1.5rem;
        margin: 0;
      }
      .navbar .logout {
        background-color: #3b82f6;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
      }

      /* ì „ì²´ ë ˆì´ì•„ì›ƒ */
      .container {
        display: flex;
        height: calc(100vh - 72px);
      }

      /* ì¢Œì¸¡ ì‚¬ì´ë“œë°” */
      .sidebar {
        width: 220px;
        background-color: #ffffff;
        border-right: 1px solid #e0e0e0;
        padding: 2rem 1rem;
      }

      .sidebar ul {
        list-style: none;
        padding: 0;
      }

      .sidebar li {
        margin-bottom: 1.2rem;
      }

      .sidebar a {
        text-decoration: none;
        color: #333;
        font-weight: 500;
        padding: 0.5rem 1rem;
        display: block;
        border-radius: 6px;
        transition: background-color 0.2s;
      }

      .sidebar a:hover {
        background-color: #e0e7ff;
      }

      /* ë³¸ë¬¸ */
      .main-content {
        flex-grow: 1;
        padding: 2rem;
        overflow-y: auto;
      }

      .main-content h2 {
        font-size: 1.4rem;
        margin-bottom: 1rem;
      }

      .placeholder-box {
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 2rem;
        color: #777;
      }

      #btn_box {
        width: 30%;
        display: flex;
        justify-content: space-between;
      }
    </style>

    <!-- Flatpickr core -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

    <!-- WeekSelect Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/weekSelect/weekSelect.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/weekSelect/weekSelect.css"
    />
  </head>
  <body>
    <div class="navbar">
      <h1>Predix ë§¤ì¶œ ì˜ˆì¸¡ ì‹œìŠ¤í…œ</h1>
      <button class="logout">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="container">
      <nav class="sidebar">
        <ul>
          <li><a href="#" onclick="loadPage('input')">ë§¤ì¶œ ì…ë ¥</a></li>
          <li><a href="#" onclick="loadPage('stats')">í†µê³„ ë³´ê¸°</a></li>
          <li><a href="#" onclick="loadPage('predict')">ë§¤ì¶œ ì˜ˆì¸¡</a></li>
        </ul>
      </nav>

      <main class="main-content" id="mainContent">
        <h2>ë§¤ì¶œ ì…ë ¥</h2>
        <div class="placeholder-box">
          <h3>ìœ í˜• ì„ íƒ</h3>
          <input name="type" id="type_month" type="radio" value="month" />
          <label for="type_month">ì›”ê°„</label>
          <input name="type" id="type_week" type="radio" value="week" />
          <label for="type_week">ì£¼ê°„</label>
          <div id="input_box">
            <div id="input_item_box"></div>
            <div id="btn_box"></div>
          </div>
        </div>
      </main>
    </div>
    <script>
      const monthInput = document.querySelector("#type_month");
      const weekInput = document.querySelector("#type_week");
      const inputBox = document.querySelector("#input_box");
      const inputItemBox = document.querySelector("#input_item_box");
      const btnBox = document.querySelector("#btn_box");

      monthInput.addEventListener("click", () => {
        inputItemBox.innerHTML = "";
        btnBox.innerHTML = "";

        const addBtn = document.createElement("button");
        const submitBtn = document.createElement("button");

        addBtn.textContent = "ì¶”ê°€";
        submitBtn.textContent = "ì œì¶œ";

        initMonthInput();

        btnBox.appendChild(addBtn);
        btnBox.appendChild(submitBtn);

        addBtn.addEventListener("click", initMonthInput);
        submitBtn.addEventListener("click", () => {
          if (confirm("ì œì¶œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            alert("ì œì¶œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
          }
        });
      });

      weekInput.addEventListener("click", () => {
        inputItemBox.innerHTML = "";
        btnBox.innerHTML = "";

        const addBtn = document.createElement("button");
        const submitBtn = document.createElement("button");

        addBtn.textContent = "ì¶”ê°€";
        submitBtn.textContent = "ì œì¶œ";

        initWeekInput();

        btnBox.appendChild(addBtn);
        btnBox.appendChild(submitBtn);

        addBtn.addEventListener("click", initWeekInput);

        submitBtn.addEventListener("click", () => {
          if (confirm("ì œì¶œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            alert("ì œì¶œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
          }
        });
      });

      function initMonthInput() {
        const row = document.createElement("div");
        row.className = "input_row";

        const startDateInput = document.createElement("input");
        startDateInput.type = "hidden";

        const endDateInput = document.createElement("input");
        endDateInput.type = "hidden";

        const monthInput = document.createElement("input");
        monthInput.type = "text";
        monthInput.placeholder = "ì›” ì„ íƒ";
        monthInput.className = "month-picker";

        const inputTag = document.createElement("input");
        inputTag.type = "number";
        inputTag.name = "amount";
        inputTag.placeholder = "ë§¤ì¶œì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "ì œê±°";
        deleteBtn.addEventListener("click", deleteContent);

        row.appendChild(startDateInput);
        row.appendChild(endDateInput);
        row.appendChild(monthInput);
        row.appendChild(inputTag);
        row.appendChild(deleteBtn);

        inputItemBox.appendChild(row);

        flatpickr(monthInput, {
          dateFormat: "Yë…„ mì›”",
          locale: "ko",
          onChange: function ([selectedDate]) {
            if (!selectedDate) return;
            // ì›” ì „ìš© UI í‰ë‚´ë‚´ê¸°
            const { firstDay, lastDay } = getMonthRange(selectedDate);
            startDateInput.value = formatDateToYYYYMMDD(firstDay);
            endDateInput.value = formatDateToYYYYMMDD(lastDay);
          },
        });
      }

      function initWeekInput() {
        const row = document.createElement("div");
        row.className = "input_row";

        const startDateInput = document.createElement("input");
        startDateInput.type = "hidden";

        const endDateInput = document.createElement("input");
        endDateInput.type = "hidden";

        const weekInput = document.createElement("input");
        weekInput.type = "text";
        weekInput.placeholder = "ì£¼ ì„ íƒ";
        weekInput.className = "week-picker";

        const inputTag = document.createElement("input");
        inputTag.type = "number";
        inputTag.name = "amount";
        inputTag.placeholder = "ë§¤ì¶œì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";

        const delBtn = document.createElement("button");
        delBtn.textContent = "ì œê±°";
        delBtn.addEventListener("click", deleteContent);

        row.appendChild(weekInput);
        row.appendChild(inputTag);
        row.appendChild(delBtn);
        row.appendChild(startDateInput);
        row.appendChild(endDateInput);

        inputItemBox.appendChild(row);

        flatpickr(weekInput, {
          locale: "ko",
          plugins: [new weekSelect({})],
          dateFormat: "Yë…„ Wì£¼ì°¨",
          onChange: function ([selectedDate], dateStr) {
            if (!selectedDate) return;

            const start = new Date(selectedDate);
            const day = start.getDay();
            const sunday = new Date(start);
            sunday.setDate(start.getDate() - day);
            const saturday = new Date(sunday);
            saturday.setDate(sunday.getDate() + 6);

            startDateInput.value = formatDateToYYYYMMDD(sunday);
            endDateInput.value = formatDateToYYYYMMDD(saturday);

            const format = (d) =>
              `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(
                2,
                "0"
              )}-${String(d.getDate()).padStart(2, "0")}`;

            //         document.getElementById("result").innerHTML = `
            //     ì„ íƒëœ ì£¼: ${format(sunday)} ~ ${format(saturday)}
            //   `;

            // ğŸ‘‰ ì—¬ê¸°ì— weekë³„ ì…ë ¥ UI ìƒì„± ë¡œì§ ë„£ìœ¼ë©´ ë¨
          },
        });
      }

      function deleteContent(e) {
        const target = e.target.closest("div");
        target.remove();
      }

      function getMonthRange(date) {
        const year = date.getFullYear();
        const month = date.getMonth();

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        return { firstDay, lastDay };
      }

      function formatDateToYYYYMMDD(dateObj) {
        const year = dateObj.getFullYear();
        const month = String(dateObj.getMonth() + 1).padStart(2, "0");
        const day = String(dateObj.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }
    </script>
  </body>
</html>
