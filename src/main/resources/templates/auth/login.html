<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout/base :: common_header(~{::title},~{::link}, ~{})}">
    <title>ìì˜ì—…ì ë§¤ì¶œ ì˜ˆì¸¡ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet"
          type="text/css"
          media="all"
          th:href="@{/css/login.css}">

</head>
<body>
<div class="login-wrapper">
    <h2>ë¡œê·¸ì¸</h2>
    <form id="loginForm">

        <div class="form-group">
            <label for="username">ì•„ì´ë””</label>
            <input type="text" id="username" name="username" placeholder="you@example.com" required />
        </div>

        <div class="form-group">
            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required />
        </div>
        <a href="/signup" class="signup-btn">
            <button type="button" class="signup-btn">íšŒì›ê°€ì…</button>
        </a>
        <button type="button" class="login-btn">ë¡œê·¸ì¸</button>
    </form>
</div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(location.search);

      // â‘  ë¡œê·¸ì•„ì›ƒ ë©”ì„¸ì§€
      if (params.get("logout") !== null) {
        showToast("ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.", "blue");
      }

      // â‘¡ ë¡œê·¸ì¸ ì‹¤íŒ¨ (?error)
      if (params.get("error") !== null) {
        showToast("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }

      if (params.has("logout") || params.has("error")) {
        history.replaceState(null, "", location.pathname);
      }
    });

    const loginBtn = document.querySelector(".login-btn");
    loginBtn.addEventListener("click",() =>{
        const username = document.querySelector("#username").value;
        const password = document.querySelector("#password").value;
        const data = {username , password}

        $.ajax({
            url : "/api/auth/login",
            method: "POST",
            data: JSON.stringify(data),
            contentType: "application/json",
            success: function(response){
                location.href='/';
            },
            error: function(error){
                console.log(error.responseJSON);
                showToast(error.responseJSON.message, "red")
            }
        })
    })


</script>
</html>
